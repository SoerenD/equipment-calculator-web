<ng-container *ngIf="(store.state$ | async) as state">
    <mat-card>
        <mat-card-content>
            <app-base-data-input
                (carryWeightChanged)="onCarryWeightChanged($event)"
                (elementAttackChanged)="onElementAttackChanged($event)"
                (elementDefenseChanged)="onElementDefenseChanged($event)"
                (rangedChanged)="onRangedChanged($event)"
                (rangedForbiddenChanged)="onRangedForbiddenChanged($event)"
                (rangedRequiredChanged)="onRangedRequiredChanged($event)"
                (schmiedekunstChanged)="onSchmiedekunstChanged($event)"
                (selectedUnitChanged)="onSelectedUnitChanged($event)"
                (unitElementChanged)="onUnitElementChanged($event)"
                (waffenschmiedeChanged)="onWaffenschmiedeChanged($event)"
                [carryWeight]="state.carryWeight"
                [elementAttack]="state.elementAttack"
                [elementDefense]="state.elementDefense"
                [rangedForbidden]="state.rangedForbidden"
                [rangedRequired]="state.rangedRequired"
                [ranged]="state.ranged"
                [schmiedekunst]="state.schmiedekunst"
                [selectedUnit]="state.selectedUnit"
                [unitElement]="state.element"
                [waffenschmiede]="state.waffenschmiede"
            ></app-base-data-input>
        </mat-card-content>
    </mat-card>

    <mat-card>
        <mat-card-content>
            <app-stat-weighting (changed)="onStatWeightingDataChanged($event)"></app-stat-weighting>
        </mat-card-content>
    </mat-card>

    <button
        (click)="calculateEquipment()"
        [class.spinner]="state.status.loading"
        [disabled]="state.status.loading"
        class="submit" color="primary"
        mat-raised-button>Ausrüstung berechnen
    </button>

    <!-- Ignored Items Display -->
    <mat-card *ngIf="state.ignoredItems.length > 0">
        <mat-card-header>
            <mat-card-title>Ignorierte Gegenstände</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="ignored-items-container">
                <mat-chip-set>
                    <mat-chip 
                        *ngFor="let item of state.ignoredItems">
                        {{ item }}
                        <button matChipRemove (click)="removeIgnoredItem(item)">
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </mat-chip>
                </mat-chip-set>
                
                <button mat-stroked-button (click)="clearIgnoredItems()" color="warn" class="clear-button">
                    Alle entfernen
                </button>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-card *ngIf="state.set as set">
        <mat-card-title>
            <button (click)="markForComparison(set)" mat-icon-button>
                <mat-icon>bookmark_border</mat-icon>
            </button>
        </mat-card-title>
        <mat-card-content>
            <app-equipment-set
                [compareWith]="state.compareSet"
                [schmiedekunst]="state.schmiedekunst"
                [set]="set"
                [unitElement]="state.element"
                (itemIgnored)="addIgnoredItem($event)"
            ></app-equipment-set>
        </mat-card-content>
    </mat-card>

    <mat-card *ngIf="state.compareSet as compareSet">
        <mat-card-title>
            <button (click)="removeCompareSet()" mat-icon-button>
                <mat-icon>bookmark</mat-icon>
            </button>
        </mat-card-title>
        <mat-card-content>
            <app-equipment-set
                [schmiedekunst]="state.schmiedekunst"
                [set]="compareSet"
                [unitElement]="state.element"
                (itemIgnored)="addIgnoredItem($event)"
            ></app-equipment-set>
        </mat-card-content>
    </mat-card>
</ng-container>
